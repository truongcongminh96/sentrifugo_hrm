TYPE=TRIGGERS
triggers='CREATE DEFINER=`root`@`%` TRIGGER `main_departments_main_requisition_summary` AFTER UPDATE ON `main_departments` FOR EACH ROW BEGIN\n			        declare unit_code varchar(200);\n				UPDATE main_requisition_summary rs SET rs.department_name = CASE WHEN NEW.isactive=1 then NEW.deptname ELSE NULL END, rs.modifiedon = utc_timestamp() \n	WHERE (rs.department_id = NEW.id);\n			        update main_leaverequest_summary ls set ls.department_name = concat(new.deptname," (",new.deptcode,")"),ls.modifieddate = utc_timestamp() \n			        where ls.department_id = new.id and ls.isactive = 1;\n			        update main_leavemanagement_summary lm set lm.department_name = concat(new.deptname," (",new.deptcode,")"),lm.modifieddate = utc_timestamp() \n			        where lm.department_id = new.id and lm.isactive = 1;\n				\n				#start of main_employees_summary\n				update main_employees_summary es set es.department_name = new.deptname,es.modifieddate = utc_timestamp() \n			        where es.department_id = new.id and es.isactive = 1;\n				#end of main_employees_summary\n			        \n			        # Start Updating BusinessUnit Id and Name if business unit is 0  \n			        if new.unitid = 0 then \n				begin \n				       update main_leavemanagement_summary lm set lm.businessunit_id = 0,lm.businessunit_name = NULL,\n			                 lm.modifieddate = utc_timestamp() where lm.department_id = new.id and lm.isactive = 1;\n			               update main_leaverequest_summary ls set ls.bunit_id = 0,ls.buss_unit_name = NULL,\n			               ls.modifieddate = utc_timestamp() where ls.department_id = new.id and ls.isactive = 1;\n				end;\n				end if; \n			        # End\n			        \n			        # Start Updating BusinessUnit Id and Name if business unit is not 0\n			        if new.unitid != 0 then \n				begin \n			               select unitcode into unit_code from main_businessunits where id = new.unitid;\n				       update main_leavemanagement_summary lm set lm.businessunit_id = new.unitid,\n			                lm.businessunit_name = concat(unit_code,"","-"),lm.modifieddate = utc_timestamp() \n			                where lm.department_id = new.id and lm.isactive = 1;\n			               update main_leaverequest_summary ls set ls.bunit_id = new.unitid,\n			               ls.buss_unit_name = concat(unit_code,"","-"),ls.modifieddate = utc_timestamp() \n			               where ls.department_id = new.id and ls.isactive = 1;\n				end;\n				end if;\n			        # End\n			    END'
sql_modes=0
definers='root@%'
client_cs_names='utf8'
connection_cl_names='utf8_general_ci'
db_cl_names='latin1_swedish_ci'
