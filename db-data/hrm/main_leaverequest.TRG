TYPE=TRIGGERS
triggers='CREATE DEFINER=`root`@`%` TRIGGER `main_leaverequest_aft_ins` AFTER INSERT ON `main_leaverequest` \n					FOR EACH ROW BEGIN\n					DECLARE user_name,repmanager_name,dept_hr_name,leave_type_name,dept_name,buss_unit_name VARCHAR(200);\n					DECLARE dept_id,bunit_id BIGINT(20);\n					SELECT userfullname INTO user_name FROM main_users WHERE id = new.user_id;\n					SELECT userfullname INTO repmanager_name FROM main_users WHERE id = new.rep_mang_id;\n					SELECT userfullname INTO dept_hr_name FROM main_users WHERE id = new.hr_id;\n					SELECT leavetype INTO leave_type_name FROM main_employeeleavetypes WHERE id = new.leavetypeid;\n					SELECT department_id INTO dept_id FROM main_employees WHERE user_id = new.user_id;\n					SELECT b.id,CONCAT(d.deptname," (",d.deptcode,")") ,\n					IF(b.unitcode != "000",CONCAT(b.unitcode,"","-"),"") INTO bunit_id,dept_name,buss_unit_name \n					FROM `main_departments` AS `d` LEFT JOIN `main_businessunits` AS `b` ON b.id=d.unitid \n					WHERE (d.isactive = 1 AND d.id = dept_id);\n					INSERT INTO main_leaverequest_summary (leave_req_id, user_id, user_name, department_id, \n					department_name, bunit_id,buss_unit_name, reason, approver_comments, leavetypeid, leavetype_name, leaveday, from_date, to_date, leavestatus, \n					rep_mang_id, rep_manager_name, hr_id,hr_name,no_of_days, appliedleavescount, is_sat_holiday, createdby, \n					modifiedby, createddate, modifieddate, isactive)\n					VALUES(new.id,new.user_id, user_name, dept_id, dept_name,bunit_id,buss_unit_name,new.reason,new.approver_comments, \n					new.leavetypeid, leave_type_name, new.leaveday, new.from_date, new.to_date, new.leavestatus, \n					new.rep_mang_id, repmanager_name,new.hr_id,dept_hr_name, new.no_of_days, new.appliedleavescount, new.is_sat_holiday, \n					new.createdby, new.modifiedby, new.createddate, new.modifieddate, new.isactive);\n					END' 'CREATE DEFINER=`root`@`%` TRIGGER `main_leaverequest_aft_upd` AFTER UPDATE ON `main_leaverequest` FOR EACH ROW BEGIN\n				    declare user_name,repmanager_name,leave_type_name,dept_name,buss_unit_name varchar(200);\n				    declare dept_id,bunit_id bigint(20);\n				    #select userfullname into user_name from main_users where id = new.user_id;\n				    #select userfullname into repmanager_name from main_users where id = new.rep_mang_id;\n				    #select leavetype into leave_type_name from main_employeeleavetypes where id = new.leavetypeid;\n				    select department_id into dept_id from main_employees where user_id = new.user_id;\n				    select b.id,concat(d.deptname," (",d.deptcode,")") ,\n				    if(b.unitcode != "000",concat(b.unitcode,"","-"),"") into bunit_id,dept_name,buss_unit_name \n				    FROM `main_departments` AS `d` LEFT JOIN `main_businessunits` AS `b` ON b.id=d.unitid \n				    WHERE (d.isactive = 1 and d.id = dept_id);\n				    UPDATE  main_leaverequest_summary set\n				    user_id = new.user_id, \n				    department_id = dept_id, \n				    department_name = dept_name, \n				    bunit_id = bunit_id,\n				    buss_unit_name = buss_unit_name,\n				    approver_comments = new.approver_comments, \n				    leavestatus = new.leavestatus, \n				    modifieddate = new.modifieddate, \n				    isactive = new.isactive where leave_req_id = new.id;\n				    END'
sql_modes=0 0
definers='root@%' 'root@%'
client_cs_names='utf8' 'utf8'
connection_cl_names='utf8_general_ci' 'utf8_general_ci'
db_cl_names='latin1_swedish_ci' 'latin1_swedish_ci'
